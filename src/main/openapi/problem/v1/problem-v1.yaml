openapi: 3.0.0
info:
  title: problem types
  version: ${project.version}
servers: []
paths: {}
components:
  responses:
    ProblemResponse:
      content:
        application/problem+json:
          schema:
            $ref: "#/components/schemas/Problem"
      description: a problem
  schemas:
    Problem:
      description: A Problem Details object (RFC 7807)
      type: object
      properties:
        type:
          type: string
          format: uri
          description: An absolute URI that identifies the problem type
          default: about:blank  # kept for backwards-compatibility, type will be mandatory in problem-v2
        href:
          type: string
          format: uri
          description: An absolute URI that, when dereferenced, provides human-readable documentation for the problem type (e.g. using HTML).
        title:
          type: string
          description: A short summary of the problem type. Written in English and readable for engineers (usually not suited for non technical stakeholders and not localized).
          example: Service Unavailable
        status:
          type: integer
          format: int32
          description: The HTTP status code generated by the origin server for this occurrence of the problem.
          minimum: 400
          maximum: 600
          exclusiveMaximum: true
          example: 503
        detail:
          type: string
          description: A human-readable explanation specific to this occurrence of the problem
        instance:
          type: string
          format: uri
          description: An absolute URI that identifies the specific occurrence of the problem. It may or may not yield further information if dereferenced.
      example:
        {
          "type": "urn:problem-type:belgif:payloadTooLarge",
          "href": "https://www.belgif.be/specification/rest/api-guide/problems/payloadTooLarge.html", # location of linked doc will change in the future to recommended URI structure
          "title": "Payload Too Large",
          "status": 413,
          "detail": "Request message must not be larger than 10 MB",
          "instance": "urn:uuid:123e4567-e89b-12d3-a456-426614174000",
          "limit": 10485760  # additional properties specific to the problem type are allowed
        }
    InvalidParamProblem:
      deprecated: true # deprecated by InputValidationProblem
      description: Problem details for invalid input parameter(s)
      type: object
      allOf:
        - $ref: "#/components/schemas/Problem"
      properties:
        invalidParams:
          type: array
          description: An array of parameter OpenAPI violations
          items:
            $ref: "#/components/schemas/InvalidParam"
    InvalidParam:
      deprecated: true # deprecated by InputValidationIssue (within an InputValidationProblem)
      type: object
      properties:
        in:
          description: The location of the invalid parameter (cfr Swagger parameters)
          type: string
          enum:
            - body
            - path
            - query
            - header
        name:
          description: The name of the invalid parameter
          type: string
        value:
          description: The value of the erroneous parameter
          # no type specified, allowing any type. This is valid OpenAPI 3.0 even though some editors may indicate an error (issue #25)
    InputValidationProblem:
      type: object
      allOf:
      - $ref: "#/components/schemas/Problem"
      properties:
        issues:
          type: array
          items:
            $ref: "#/components/schemas/InputValidationIssue"
      example:
        type:  urn:problem-type:belgif:badRequest 
        href: https://www.belgif.be/specification/rest/api-guide/problems/badRequest.html
        title: Bad Request
        status: 400
        detail:  "The input message is incorrect"
        instance: urn:uuid:123456-1234-1235-4567489798
        issues:
        - type: urn:problem-type:belgif:input-validation:schemaViolation #mandatory
          # href: TODO: foresee dereferenceable link for belgif input validation problems
          title: "Input isn't valid with respect to schema"
          detail: enterpriseNumber abc should be numeric # recommended, if more detail can be provided
          in: path
          name: enterpriseNumber
          value: abc
        - type: urn:problem-type:cbss:input-validation:replacedSsin # example of custom input validation issue defined by organization "CBSS"
          href: https://api.ksz-bcss.fgov.be/problems/replacedSsin
          title: "SSIN has been replaced. Use new ssin."
          detail: "SSIN 12345678901 has been replaced by 23456789012"
          in: body
          name: parent[0].ssin
          value: "12345678901" 
          replacedBy: "23456789012" 
        - type: urn:problem-type:cbss:input-validation:invalidPeriod
          title: period is invalid
          detail: endDate should be after startDate
          in: body
          name: period
          value:
            startDate: "2020-12-31" 
            endDate: "2020-01-01" 
        - type: urn:problem-type:cbss:input-validation:invalidSsin
          title: "There is no person with the given SSIN"
          in: path
          name: ssin
          value: "12345678911"
    InputValidationIssue:
      type: object
      allOf:
        - $ref: "#/components/schemas/Problem"
        # status property of Problem is usually not used for input validation issues
      properties:
        in:
          type: string
          enum:
            - body
            - header
            - path
            - query
        name:
          type: string
        value: {} # any type allowed
